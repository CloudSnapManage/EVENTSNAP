import Je from"react";import Ke from"react-dom/client";import{useState as k,useCallback as Fe,useEffect as Be,useRef as $e}from"react";import{jsx as d,jsxs as I}from"react/jsx-runtime";var h={Camera:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),d("circle",{cx:"12",cy:"13",r:"3"})]}),Share:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"}),d("polyline",{points:"16 6 12 2 8 6"}),d("line",{x1:"12",y1:"2",x2:"12",y2:"15"})]}),Download:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),d("polyline",{points:"7 10 12 15 17 10"}),d("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),Users:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),d("circle",{cx:"9",cy:"7",r:"4"}),d("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),d("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),Grid:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("rect",{x:"3",y:"3",width:"7",height:"7"}),d("rect",{x:"14",y:"3",width:"7",height:"7"}),d("rect",{x:"14",y:"14",width:"7",height:"7"}),d("rect",{x:"3",y:"14",width:"7",height:"7"})]}),Plus:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),d("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),X:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),d("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Sync:a=>I("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[d("path",{d:"M21 2v6h-6"}),d("path",{d:"M3 12a9 9 0 0 1 15-6.7L21 8"}),d("path",{d:"M3 22v-6h6"}),d("path",{d:"M21 12a9 9 0 0 1-15 6.7L3 16"})]}),Star:a=>d("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:d("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),Check:a=>d("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:d("polyline",{points:"20 6 9 17 4 12"})})};import{useState as le}from"react";import{jsx as j,jsxs as Q}from"react/jsx-runtime";var Re=({photo:a,onClose:e})=>Q("div",{className:"fixed inset-0 z-[300] flex flex-col items-center justify-center bg-black/95 backdrop-blur-3xl animate-in fade-in zoom-in-95 duration-300",children:[Q("div",{className:"absolute top-6 left-0 right-0 px-6 flex items-center justify-between z-[310]",children:[Q("div",{className:"flex flex-col",children:[j("span",{className:"text-[10px] font-black text-white/50 uppercase tracking-widest",children:a.senderName}),j("span",{className:"text-sm font-bold text-white/90",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),j("button",{onClick:e,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all backdrop-blur-md",children:j(h.X,{className:"w-6 h-6"})})]}),j("div",{className:"relative w-full h-full flex items-center justify-center p-4",children:a.mimeType.startsWith("video")?j("video",{src:a.url,controls:!0,autoPlay:!0,className:"max-h-full max-w-full rounded-2xl shadow-2xl"}):j("img",{src:a.url,alt:a.caption,className:"max-h-full max-w-full rounded-2xl shadow-2xl object-contain"})}),a.caption&&j("div",{className:"absolute bottom-10 left-0 right-0 px-8 text-center animate-in slide-in-from-bottom-4 duration-500",children:Q("p",{className:"text-xl md:text-2xl font-black text-white leading-tight max-w-2xl mx-auto italic",children:['"',a.caption,'"']})})]}),ie=Re;import{Fragment as Ie,jsx as C,jsxs as z}from"react/jsx-runtime";var Ee=({photo:a,isHost:e,onFeature:s,isFeatured:o})=>{let[r,c]=le(!1),[i,u]=le(!1);return z(Ie,{children:[z("div",{className:`group relative overflow-hidden rounded-2xl bg-white/[0.03] border transition-all cursor-pointer hover:shadow-2xl hover:shadow-black/60 ${o?"border-yellow-500/50 shadow-[0_0_20px_rgba(234,179,8,0.2)]":"border-white/5"}`,children:[z("div",{onClick:()=>u(!0),className:"aspect-[3/4] sm:aspect-[4/5] w-full relative overflow-hidden bg-slate-900/40",children:[!r&&C("div",{className:"absolute inset-0 flex items-center justify-center",children:C("div",{className:"w-8 h-8 rounded-full border-2 border-white/10 border-t-white/40 animate-spin"})}),a.mimeType.startsWith("video")?C("video",{src:a.url,className:`h-full w-full object-cover transition-opacity duration-700 ${r?"opacity-100":"opacity-0"}`,onLoadedData:()=>c(!0),muted:!0,loop:!0,playsInline:!0,onMouseOver:w=>w.currentTarget.play(),onMouseOut:w=>w.currentTarget.pause()}):C("img",{src:a.url,alt:a.caption||"Event moment",className:`h-full w-full object-cover transition-all duration-700 group-hover:scale-105 ${r?"opacity-100":"opacity-0"}`,onLoad:()=>c(!0),loading:"lazy"}),o&&z("div",{className:"absolute top-2 left-2 flex items-center gap-1.5 px-2 py-1 bg-yellow-500/80 backdrop-blur-md rounded-lg border border-white/20 z-10",children:[C(h.Star,{className:"w-3 h-3 text-white fill-current"}),C("span",{className:"text-[8px] font-black text-white uppercase tracking-tighter",children:"Featured"})]}),!o&&z("div",{className:"absolute top-2 left-2 flex items-center gap-1.5 px-2 py-1 bg-black/40 backdrop-blur-md rounded-lg border border-white/5 opacity-0 group-hover:opacity-100 transition-opacity",children:[C("div",{className:"w-5 h-5 rounded-full bg-white/10 flex items-center justify-center text-[10px] font-black text-white",children:a.senderName.charAt(0).toUpperCase()}),C("span",{className:"text-[9px] font-black text-white/80 uppercase tracking-tighter",children:a.senderName})]}),a.mimeType.startsWith("video")&&C("div",{className:"absolute top-2 right-2 bg-blue-500/80 backdrop-blur-md px-2 py-0.5 rounded text-[8px] font-black text-white uppercase tracking-widest border border-white/10",children:"VIDEO"})]}),e&&s&&C("button",{onClick:w=>{w.stopPropagation(),s(a.id)},className:`absolute top-2 right-2 p-2 rounded-xl backdrop-blur-md border transition-all z-20 opacity-0 group-hover:opacity-100 active:scale-90 ${o?"bg-yellow-500 text-white border-yellow-400":"bg-black/60 text-white border-white/10 hover:bg-yellow-500"}`,title:"Feature on Live Wall",children:C(h.Star,{className:`w-4 h-4 ${o?"fill-current":""}`})}),z("div",{onClick:()=>u(!0),className:"absolute inset-x-0 bottom-0 flex flex-col justify-end bg-gradient-to-t from-black via-black/40 to-transparent p-3 opacity-0 transition-all duration-300 group-hover:opacity-100 translate-y-1 group-hover:translate-y-0",children:[C("p",{className:"text-[10px] font-black text-white/50 uppercase tracking-widest mb-0.5",children:a.senderName}),C("p",{className:"text-[11px] font-bold text-white line-clamp-1 leading-snug",children:a.caption||"View Moment"})]})]}),i&&C(ie,{photo:a,onClose:()=>u(!1)})]})},ce=Ee;import{useState as je,useEffect as de}from"react";import{jsx as f,jsxs as D}from"react/jsx-runtime";var De=({photos:a,onClose:e,featuredId:s})=>{let[o,r]=je(0);if(de(()=>{if(s){let i=a.findIndex(u=>u.id===s);i!==-1&&r(i)}},[s,a]),de(()=>{if(a.length<=1)return;let i=setInterval(()=>{r(u=>(u+1)%a.length)},8e3);return()=>clearInterval(i)},[a.length]),a.length===0)return D("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-slate-950",children:[f("button",{onClick:e,className:"absolute right-8 top-8 text-white/50 hover:text-white transition-all",children:f(h.X,{className:"h-8 w-8"})}),D("div",{className:"text-center space-y-4",children:[f("div",{className:"w-16 h-16 bg-white/5 rounded-full mx-auto flex items-center justify-center border border-white/5",children:f(h.Camera,{className:"w-8 h-8 text-slate-700"})}),f("p",{className:"text-xl font-black text-slate-500 uppercase tracking-[0.2em]",children:"Wall is empty"})]})]});let c=a[o];return D("div",{className:"fixed inset-0 z-[200] flex flex-col items-center justify-center bg-black overflow-hidden select-none",children:[f("button",{onClick:e,className:"absolute right-8 top-8 z-[210] p-4 bg-white/10 hover:bg-white/20 rounded-2xl text-white transition-all backdrop-blur-md active:scale-95",children:f(h.X,{className:"h-6 w-6"})}),f("div",{className:"absolute inset-0 opacity-40 blur-[100px] transition-all duration-1000 scale-150 pointer-events-none",children:f("img",{src:c.url,className:"w-full h-full object-cover",alt:""})}),f("div",{className:"relative flex h-full w-full items-center justify-center p-6 md:p-20",children:D("div",{className:"relative z-10 flex h-full w-full max-w-6xl flex-col items-center justify-center gap-10",children:[D("div",{className:"relative h-full max-h-[70vh] w-full flex items-center justify-center",children:[c.id===s&&D("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 flex items-center gap-3 px-6 py-2 bg-yellow-500 rounded-full shadow-[0_0_40px_rgba(234,179,8,0.4)] border border-yellow-400 z-50 animate-bounce",children:[f(h.Star,{className:"w-4 h-4 text-white fill-current"}),f("span",{className:"text-xs font-black text-white uppercase tracking-widest",children:"Host Picked This"})]}),c.mimeType.startsWith("video")?f("video",{src:c.url,autoPlay:!0,muted:!0,className:"max-h-full max-w-full rounded-[2.5rem] object-contain shadow-[0_50px_100px_-20px_rgba(0,0,0,0.8)] border border-white/5 animate-in fade-in zoom-in-95 duration-1000"},c.id):f("img",{src:c.url,alt:"Live Snap",className:"max-h-full max-w-full rounded-[2.5rem] object-contain shadow-[0_50px_100px_-20px_rgba(0,0,0,0.8)] border border-white/5 animate-in fade-in zoom-in-95 duration-1000"},c.id)]}),D("div",{className:"text-center space-y-4 max-w-3xl animate-in slide-in-from-bottom-8 duration-1000",children:[f("h2",{className:"text-3xl font-black text-white md:text-5xl tracking-tight leading-tight",children:c.caption||"Moment captured"}),D("div",{className:"flex items-center justify-center gap-3",children:[f("span",{className:"w-8 h-px bg-white/20"}),f("p",{className:"text-lg md:text-xl font-bold text-white/50 uppercase tracking-[0.2em]",children:c.senderName}),f("span",{className:"w-8 h-px bg-white/20"})]})]})]})}),f("div",{className:"absolute bottom-12 left-0 flex w-full justify-center gap-3 px-10 no-scrollbar",children:a.slice(-15).map((i,u)=>f("div",{className:`h-1 rounded-full transition-all duration-700 ${i.id===c.id?"w-12 bg-white":"w-2 bg-white/10"}`},i.id))})]})},ue=De;import{useEffect as Me,useRef as me,useState as Ae}from"react";import _e from"jsqr";import{Fragment as Oe,jsx as g,jsxs as O}from"react/jsx-runtime";var Te=({onScan:a,onClose:e,onManual:s})=>{let o=me(null),r=me(null),[c,i]=Ae(null);return Me(()=>{let u=null,w,A=async()=>{try{u=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),o.current&&(o.current.srcObject=u,o.current.setAttribute("playsinline","true"),o.current.play(),requestAnimationFrame(L))}catch(b){let R="Camera access required.";(b.name==="NotAllowedError"||b.message?.toLowerCase().includes("denied"))&&(R="Permission denied by system. Please enable camera in your settings or use the Manual Key fallback below."),i(R),console.error("Camera access failed:",b)}},L=()=>{if(o.current&&o.current.readyState===o.current.HAVE_ENOUGH_DATA){let b=r.current,R=o.current;if(b){let N=b.getContext("2d");if(N){b.height=R.videoHeight,b.width=R.videoWidth,N.drawImage(R,0,0,b.width,b.height);let F=N.getImageData(0,0,b.width,b.height),y=_e(F.data,F.width,F.height,{inversionAttempts:"dontInvert"});if(y)try{if(y.data.includes("offer=")){let U=new URL(y.data).searchParams.get("offer");if(U){a(U);return}}if(y.data.startsWith("o|")||y.data.startsWith("a|")){a(y.data);return}}catch{if(y.data.startsWith("o|")||y.data.startsWith("a|")){a(y.data);return}}}}}w=requestAnimationFrame(L)};return A(),()=>{u&&u.getTracks().forEach(b=>b.stop()),cancelAnimationFrame(w)}},[a]),O("div",{className:"fixed inset-0 z-[200] flex flex-col items-center justify-center bg-black/95 backdrop-blur-xl animate-in fade-in duration-300",children:[O("div",{className:"absolute top-8 left-0 right-0 px-8 flex justify-between items-center z-10",children:[g("h3",{className:"text-xl font-black text-white uppercase tracking-widest",children:"Scanner"}),g("button",{onClick:e,className:"p-4 bg-white/10 hover:bg-white/20 rounded-2xl text-white transition-all backdrop-blur-md active:scale-95",children:g(h.X,{className:"h-6 w-6"})})]}),g("div",{className:"relative w-full max-w-md aspect-square rounded-[3rem] overflow-hidden border-4 border-white/10 mx-6 bg-slate-900 shadow-2xl",children:c?O("div",{className:"absolute inset-0 flex flex-col items-center justify-center p-8 text-center bg-slate-900",children:[g("div",{className:"w-16 h-16 bg-rose-500/20 rounded-full flex items-center justify-center mb-6",children:g(h.X,{className:"w-8 h-8 text-rose-500"})}),g("p",{className:"text-slate-300 font-bold leading-relaxed mb-8",children:c}),O("div",{className:"flex flex-col gap-3 w-full",children:[s&&g("button",{onClick:s,className:"w-full py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest shadow-xl active:scale-95 transition-transform",children:"Use Manual Sync Key"}),g("button",{onClick:e,className:"w-full py-4 bg-white/5 text-slate-400 rounded-2xl font-black uppercase text-xs tracking-widest",children:"Go Back"})]})]}):O(Oe,{children:[g("video",{ref:o,className:"absolute inset-0 w-full h-full object-cover grayscale opacity-50"}),g("canvas",{ref:r,className:"hidden"}),g("div",{className:"absolute inset-0 border-[60px] border-black/40",children:O("div",{className:"w-full h-full border-2 border-blue-500 relative",children:[g("div",{className:"absolute top-0 left-0 right-0 h-1 bg-blue-500 shadow-[0_0_30px_rgba(59,130,246,1)] scan-line"}),g("div",{className:"absolute -top-1 -left-1 w-12 h-12 border-t-8 border-l-8 border-blue-500 rounded-tl-xl"}),g("div",{className:"absolute -top-1 -right-1 w-12 h-12 border-t-8 border-r-8 border-blue-500 rounded-tr-xl"}),g("div",{className:"absolute -bottom-1 -left-1 w-12 h-12 border-b-8 border-l-8 border-blue-500 rounded-bl-xl"}),g("div",{className:"absolute -bottom-1 -right-1 w-12 h-12 border-b-8 border-r-8 border-blue-500 rounded-br-xl"})]})})]})}),!c&&O("div",{className:"mt-12 text-center space-y-6 max-w-xs px-4",children:[g("p",{className:"text-slate-400 font-black uppercase tracking-[0.2em] text-[10px] animate-pulse",children:"Scan the sync code on the other device"}),g("button",{onClick:s,className:"text-blue-500 text-[10px] font-black uppercase tracking-widest border border-blue-500/20 px-6 py-3 rounded-full hover:bg-blue-500/10 transition-colors active:scale-95",children:"Prefer Manual Entry?"})]})]})},pe=Te;import{GoogleGenAI as Ue}from"@google/genai";var We=new Ue({apiKey:""});async function he(a,e){try{return(await We.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:[{inlineData:{data:a,mimeType:e}},{text:"Write a short, fun, 1-sentence caption for this photo from a party/event. Be creative and enthusiastic!"}]},config:{maxOutputTokens:60}})).text?.trim()||"Event vibes! \u2728"}catch(s){return console.error("Caption generation failed:",s),"Amazing moment! \u{1F4F8}"}}var ze="EventSnap_v1",M="album",ee=class{constructor(){this.db=null}async init(){return new Promise((e,s)=>{let o=indexedDB.open(ze,1);o.onupgradeneeded=r=>{let c=r.target.result;c.objectStoreNames.contains(M)||c.createObjectStore(M,{keyPath:"id"})},o.onsuccess=()=>{this.db=o.result,e()},o.onerror=()=>s(o.error)})}async savePhoto(e){return this.db||await this.init(),new Promise((s,o)=>{let r=this.db.transaction(M,"readwrite");r.objectStore(M).put(e),r.oncomplete=()=>s(),r.onerror=()=>o(r.error)})}async getPhotos(){return this.db||await this.init(),new Promise((e,s)=>{let r=this.db.transaction(M,"readonly").objectStore(M).getAll();r.onsuccess=()=>e(r.result),r.onerror=()=>s(r.error)})}async deletePhoto(e){return this.db||await this.init(),new Promise((s,o)=>{let r=this.db.transaction(M,"readwrite");r.objectStore(M).delete(e),r.oncomplete=()=>s()})}},H=new ee;var B=32*1024,He=1024*1024;function fe(a){return a.split(`
`).filter(e=>{if(e.startsWith("a=extmap:")||e.startsWith("a=msid:")||e.startsWith("a=rtcp-fb:")||e.startsWith("a=fmtp:")||e.startsWith("a=rtpmap:")||e.startsWith("a=ssrc:"))return!1;if(e.startsWith("a=candidate:")){let s=e.toLowerCase().includes("udp"),o=e.includes("typ host")||e.includes("typ srflx"),r=e.includes(":")&&e.split(" ").some(c=>c.includes(":"));return s&&o&&!r}return!0}).join(`
`).replace(/\r/g,"")}var J=class{constructor(e){this.dc=null;this.incomingFiles=new Map;this.callbacks=e,this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}),this.pc.oniceconnectionstatechange=()=>{console.log("[P2P] ICE State:",this.pc.iceConnectionState),this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed"?this.callbacks.onStatusChange("connected"):this.pc.iceConnectionState==="failed"&&this.callbacks.onStatusChange("error")},this.pc.ondatachannel=s=>this.setupDataChannel(s.channel)}async createOffer(){this.callbacks.onStatusChange("gathering"),this.dc=this.pc.createDataChannel("snap-sync",{ordered:!0}),this.setupDataChannel(this.dc);let e=await this.pc.createOffer();return await this.pc.setLocalDescription(e),await this.waitForICE(),this.callbacks.onStatusChange("ready"),`o|${fe(this.pc.localDescription.sdp)}`}async createAnswer(e){this.callbacks.onStatusChange("gathering");let[s,o]=e.split("|");if(s!=="o")throw new Error("Expected offer (o|) format");await this.pc.setRemoteDescription({type:"offer",sdp:o});let r=await this.pc.createAnswer();return await this.pc.setLocalDescription(r),await this.waitForICE(),this.callbacks.onStatusChange("ready"),`a|${fe(this.pc.localDescription.sdp)}`}async acceptAnswer(e){let[s,o]=e.split("|");if(s!=="a")throw new Error("Expected answer (a|) format");await this.pc.setRemoteDescription({type:"answer",sdp:o})}waitForICE(){return new Promise(e=>{if(this.pc.iceGatheringState==="complete")e();else{let s=()=>{this.pc.iceGatheringState==="complete"&&(this.pc.removeEventListener("icegatheringstatechange",s),e())};this.pc.addEventListener("icegatheringstatechange",s),setTimeout(e,1500)}})}setupDataChannel(e){this.dc=e,e.binaryType="arraybuffer",e.onopen=()=>{console.log("[P2P] DataChannel Open"),this.callbacks.onStatusChange("connected")},e.onmessage=s=>this.handleMessage(s.data),e.onclose=()=>{console.log("[P2P] DataChannel Closed"),this.callbacks.onStatusChange("idle")}}async handleMessage(e){if(typeof e=="string"){let s=JSON.parse(e);s.type==="META"&&this.incomingFiles.set(s.id,{meta:s,chunks:new Array(Math.ceil(s.size/B)),receivedChunks:0})}else{let s=new Uint8Array(e),o=new TextDecoder().decode(s.slice(0,8)).trim(),r=new DataView(s.buffer,8,4).getUint32(0),c=s.slice(12),i=this.incomingFiles.get(o);if(!i)return;if(i.chunks[r]=c,i.receivedChunks++,this.callbacks.onProgress&&this.callbacks.onProgress(o,i.receivedChunks*B,i.meta.size),i.receivedChunks===i.chunks.length){let u=new Blob(i.chunks,{type:i.meta.mimeType}),w={...i.meta,blob:u,url:URL.createObjectURL(u)};this.callbacks.onPhotoReceived(w),this.incomingFiles.delete(o)}}}async broadcastPhoto(e){if(!this.dc||this.dc.readyState!=="open")return;this.dc.send(JSON.stringify({type:"META",id:e.id,senderId:e.senderId,senderName:e.senderName,timestamp:e.timestamp,caption:e.caption,mimeType:e.mimeType,size:e.blob.size}));let s=await e.blob.arrayBuffer(),o=Math.ceil(s.byteLength/B),r=e.id.padEnd(8).slice(0,8),c=new TextEncoder().encode(r);for(let i=0;i<o;i++){this.dc.bufferedAmount>He&&await new Promise(b=>this.dc.onbufferedamountlow=b);let u=i*B,w=Math.min(u+B,s.byteLength),A=s.slice(u,w),L=new Uint8Array(12+A.byteLength);L.set(c,0),new DataView(L.buffer).setUint32(8,i),L.set(new Uint8Array(A),12),this.dc.send(L)}}destroy(){this.pc.close()}};import qe from"jszip";import Ge from"qrcode";import{jsx as t,jsxs as l}from"react/jsx-runtime";var Qe=()=>{let[a,e]=k("home"),[s,o]=k(null),[r,c]=k(null),[i,u]=k([]),[w,A]=k(!1),[L,b]=k(!1),[R,N]=k(!1),[F,y]=k(!1),[E,U]=k(""),[te,we]=k(""),[K,_]=k("idle"),[$,ve]=k("idle"),[q,ae]=k("qr"),[V,se]=k(""),[X,ne]=k(!1),P=$e(null);Be(()=>{(async()=>{await H.init();let m=new URLSearchParams(window.location.search).get("offer");if(m){U(m),_("showing_answer"),e("join");return}let x=localStorage.getItem("eventsnap_user"),v=localStorage.getItem("eventsnap_session");if(x&&v){o(JSON.parse(x)),c(JSON.parse(v)),e("gallery");let S=await H.getPhotos();u(S),G()}})()},[]);let G=Fe(()=>(P.current&&P.current.destroy(),P.current=new J({onStatusChange:n=>ve(n),onPhotoReceived:n=>{u(p=>p.find(m=>m.id===n.id)?p:(H.savePhoto(n),[...p,n]))}}),P.current),[]),ye=async n=>{n.preventDefault();let p=new FormData(n.currentTarget),m=Math.random().toString(36).substring(2,10),x=Math.random().toString(36).substring(2,8).toUpperCase(),v={id:m,name:p.get("userName")||"Host",isHost:!0},S={id:x,name:p.get("eventName")||"Event",hostId:m,startTime:Date.now()};o(v),c(S),localStorage.setItem("eventsnap_user",JSON.stringify(v)),localStorage.setItem("eventsnap_session",JSON.stringify(S));let T=await G().createOffer();Y(T),_("showing_offer"),e("gallery"),N(!0)},ke=async n=>{if(n.preventDefault(),!E){alert("No invitation data found. Please scan the host QR or use the invitation link.");return}ne(!0);let p=new FormData(n.currentTarget),m=Math.random().toString(36).substring(2,10),x=(p.get("userName")||"Guest").trim(),v={id:m,name:x,isHost:!1},S={id:"SYNCING",name:"Connecting...",hostId:"unknown",startTime:Date.now()};o(v),c(S),localStorage.setItem("eventsnap_user",JSON.stringify(v)),localStorage.setItem("eventsnap_session",JSON.stringify(S));let W=P.current||G();try{let T=await W.createAnswer(E);Y(T),e("gallery"),_("showing_answer"),N(!0)}catch(T){console.error("Join failed:",T),alert("Handshake failed. The invitation key might be invalid."),ne(!1)}},Y=async n=>{U(n);try{let p=await Ge.toDataURL(n,{scale:10,margin:2,errorCorrectionLevel:"L"});we(p)}catch(p){console.error("QR Generation failed",p)}},Ne=async()=>{if(!V)return;let n=V.trim().replace(/-/g,"");se(""),await oe(n)},oe=async n=>{if(y(!1),n.startsWith("o|"))if(U(n),s){let m=await(P.current||G()).createAnswer(n);Y(m),_("showing_answer"),N(!0)}else e("join");else if(n.startsWith("a|")){if(!P.current){alert("Session lost. Please refresh and try again.");return}try{await P.current.acceptAnswer(n),_("connected"),N(!1)}catch{alert("Sync failed. Ensure you scan the Guest's QR code.")}}else alert("Invalid Code. Ensure it starts with 'o|' or 'a|'.")},re=(n,p)=>{navigator.clipboard.writeText(n).then(()=>{alert(`${p} copied!`)}).catch(m=>{console.error("Copy failed",m),alert("Could not copy automatically. Please select text manually.")})},Ce=async n=>{if(!n.target.files||!s)return;A(!0);let p=Array.from(n.target.files);for(let m of p){let x={id:Math.random().toString(36).substring(2,10),url:URL.createObjectURL(m),blob:m,senderId:s.id,senderName:s.name,timestamp:Date.now(),mimeType:m.type};if(u(v=>[...v,x]),await H.savePhoto(x),m.type.startsWith("image/")){let v=new FileReader;v.onload=async()=>{let S=v.result.split(",")[1],W=await he(S,m.type);u(T=>T.map(Z=>Z.id===x.id?{...Z,caption:W}:Z)),H.savePhoto({...x,caption:W}),P.current?.broadcastPhoto({...x,caption:W})},v.readAsDataURL(m)}else P.current?.broadcastPhoto(x)}A(!1)},Se=async()=>{let n=new qe;i.forEach((x,v)=>{let S=x.mimeType.split("/")[1]||"jpg";n.file(`snap_${v}_${x.id}.${S}`,x.blob)});let p=await n.generateAsync({type:"blob"}),m=document.createElement("a");m.href=URL.createObjectURL(p),m.download=`${r?.name||"Event"}_Album.zip`,m.click()},Pe=E.match(/.{1,4}/g)?.join("-")||E;if(L)return t(ue,{photos:i,onClose:()=>b(!1)});if(F)return t(pe,{onScan:oe,onClose:()=>y(!1),onManual:()=>{y(!1),ae("manual"),N(!0)}});let Le=r?`${window.location.origin}${window.location.pathname}?offer=${encodeURIComponent(E)}`:"";return l("div",{className:"min-h-screen flex flex-col p-4 md:p-10 relative",children:[l("header",{className:"flex items-center justify-between mb-8 relative z-10",children:[l("div",{className:"flex items-center gap-4 cursor-pointer",onClick:()=>e("home"),children:[t("div",{className:"p-3 rounded-2xl bg-blue-500 shadow-xl",children:t(h.Camera,{className:"text-white w-6 h-6"})}),t("h1",{className:"text-2xl font-black text-white uppercase tracking-tighter",children:"EventSnap"})]}),s&&l("div",{className:"flex items-center gap-3",children:[l("div",{className:"px-4 py-1.5 bg-white/5 rounded-full border border-white/10 flex items-center gap-2",children:[t("div",{className:`w-2 h-2 rounded-full ${$==="connected"?"bg-emerald-500 animate-pulse":"bg-slate-600"}`}),t("span",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:$})]}),t("button",{onClick:()=>{localStorage.clear(),window.location.reload()},className:"p-2 hover:bg-white/10 rounded-xl text-slate-500",title:"Sign Out",children:t(h.X,{className:"w-5 h-5"})})]})]}),l("main",{className:"flex-1 max-w-7xl mx-auto w-full relative z-10",children:[a==="home"&&l("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center space-y-12",children:[l("h2",{className:"text-6xl md:text-8xl font-black text-white leading-tight tracking-tighter",children:["Private Sync.",t("br",{}),t("span",{className:"text-blue-500",children:"Zero Servers."})]}),l("div",{className:"flex flex-col md:flex-row gap-6 w-full max-w-2xl",children:[l("form",{onSubmit:ye,className:"flex-1 glass-morphism p-8 rounded-[2.5rem] space-y-4",children:[t("input",{required:!0,name:"eventName",className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white placeholder:text-slate-600 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"Event Name"}),t("input",{required:!0,name:"userName",className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white placeholder:text-slate-600 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"Your Name (Host)"}),t("button",{type:"submit",className:"w-full py-5 bg-blue-600 rounded-2xl font-black text-white hover:bg-blue-500 transition-all shadow-xl shadow-blue-500/20 uppercase text-sm tracking-widest",children:"Start Album"})]}),t("div",{className:"flex-1 flex flex-col gap-4",children:l("button",{onClick:()=>y(!0),className:"flex-1 glass-morphism rounded-[2.5rem] border border-white/10 flex flex-col items-center justify-center gap-4 hover:bg-white/5 transition-all group p-8",children:[t("div",{className:"p-5 bg-blue-500/10 rounded-2xl group-hover:bg-blue-500/20 transition-colors",children:t(h.Share,{className:"w-10 h-10 text-blue-500 group-hover:scale-110 transition-transform"})}),t("span",{className:"font-black uppercase tracking-widest text-xs text-white/80",children:"Join Event"})]})})]})]}),a==="join"&&l("div",{className:"flex flex-col items-center justify-center min-h-[50vh] text-center space-y-8 animate-in fade-in slide-in-from-bottom-4",children:[t("div",{className:"p-6 bg-blue-500/10 rounded-[2rem] border border-blue-500/20",children:t(h.Users,{className:"w-16 h-16 text-blue-500 mx-auto"})}),l("div",{children:[t("h2",{className:"text-4xl font-black text-white",children:"Guest Profile"}),t("p",{className:"text-slate-500 font-bold mt-2 uppercase text-[10px] tracking-widest",children:"Invite Code Loaded Successfully"})]}),l("form",{onSubmit:ke,className:"w-full max-w-md glass-morphism p-8 rounded-[2.5rem] space-y-4",children:[t("input",{required:!0,name:"userName",className:"w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white placeholder:text-slate-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:"Enter Your Name",autoFocus:!0}),t("button",{type:"submit",disabled:X,className:`w-full py-5 bg-blue-600 rounded-2xl font-black text-white hover:bg-blue-500 transition-all uppercase text-sm tracking-widest shadow-xl shadow-blue-500/20 ${X?"opacity-50 cursor-not-allowed":""}`,children:X?"Syncing...":"Connect to Host"})]}),t("button",{onClick:()=>e("home"),className:"text-[10px] font-black text-slate-500 uppercase tracking-widest hover:text-white transition-colors",children:"Cancel Connection"})]}),a==="gallery"&&l("div",{className:"space-y-8 pb-48",children:[l("div",{className:"sticky top-6 z-40 p-4 glass-morphism rounded-3xl flex items-center justify-between border border-white/10 shadow-2xl",children:[l("div",{className:"flex flex-col ml-2",children:[t("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"P2P Album"}),t("span",{className:"text-xl font-black text-white tracking-tight",children:r?.name})]}),l("div",{className:"flex gap-2",children:[t("button",{onClick:()=>b(!0),className:"px-6 py-3 bg-white/5 rounded-xl text-[10px] font-black text-white hover:bg-white/10 uppercase tracking-widest",children:"Live Wall"}),t("button",{onClick:()=>{_(s?.isHost?"showing_offer":"showing_answer"),N(!0)},className:"px-6 py-3 bg-blue-600 rounded-xl text-[10px] font-black text-white uppercase tracking-widest",children:"Sync Keys"}),t("button",{onClick:Se,className:"p-3 bg-white/10 rounded-xl text-white hover:bg-white/20",children:t(h.Download,{className:"w-4 h-4"})})]})]}),i.length===0?l("div",{className:"flex flex-col items-center justify-center py-40 text-slate-700",children:[t("div",{className:"w-24 h-24 bg-white/5 rounded-full flex items-center justify-center mb-6 animate-pulse border border-white/5",children:t(h.Camera,{className:"w-10 h-10 opacity-20"})}),t("p",{className:"font-black uppercase tracking-[0.2em] text-[10px]",children:"Empty Album"}),$!=="connected"&&l("div",{className:"flex flex-col items-center gap-2 mt-4",children:[t("p",{className:"text-[10px] text-blue-500/30 uppercase font-black",children:"Direct Connection Required"}),t("button",{onClick:()=>{_(s?.isHost?"showing_offer":"showing_answer"),N(!0)},className:"text-[9px] font-black text-blue-500 underline underline-offset-4 uppercase tracking-widest",children:"Open Sync Portal"})]})]}):t("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6",children:i.sort((n,p)=>p.timestamp-n.timestamp).map(n=>t(ce,{photo:n},n.id))}),t("div",{className:"fixed bottom-10 left-0 right-0 z-50 flex justify-center",children:l("label",{className:`cursor-pointer bg-white text-black px-16 py-8 rounded-full font-black text-2xl shadow-2xl hover:scale-105 active:scale-95 transition-all ${w?"opacity-50 pointer-events-none animate-pulse":""}`,children:[w?"BROADCASTING...":"CAPTURE MOMENT",t("input",{type:"file",multiple:!0,accept:"image/*,video/*",className:"hidden",onChange:Ce,disabled:w})]})})]})]}),R&&t("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/95 backdrop-blur-xl",onClick:()=>N(!1),children:l("div",{className:"bg-white p-8 md:p-10 rounded-[3rem] text-center space-y-6 w-full max-w-lg animate-in zoom-in-95",onClick:n=>n.stopPropagation(),children:[l("div",{children:[t("h4",{className:"text-2xl font-black text-black tracking-tight",children:K==="showing_offer"?"Invite Your Friends":"Sync Step 2"}),t("p",{className:"text-[10px] text-slate-500 font-black uppercase tracking-widest mt-2",children:"Secure Peer Handshake"})]}),t("div",{className:"flex bg-slate-100 p-1 rounded-2xl",children:["qr","link","manual"].map(n=>t("button",{onClick:()=>ae(n),className:`flex-1 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${q===n?"bg-white text-blue-600 shadow-sm":"text-slate-400"}`,children:n==="manual"?"Sync Key":n==="link"?"Invite Link":"QR Scan"},n))}),l("div",{className:"min-h-[300px] flex flex-col justify-center",children:[q==="qr"&&l("div",{className:"space-y-4",children:[t("div",{className:"aspect-square w-full max-w-[280px] mx-auto p-4 bg-white rounded-3xl border-2 border-slate-100 flex items-center justify-center shadow-inner overflow-hidden",children:$==="gathering"?l("div",{className:"flex flex-col items-center gap-4",children:[t("div",{className:"w-10 h-10 rounded-full border-4 border-blue-500 border-t-transparent animate-spin"}),t("span",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest",children:"Generating Key..."})]}):te?t("img",{src:te,className:"w-full h-full object-contain image-render-pixel",alt:"Handshake QR"}):t("p",{className:"text-xs text-slate-400",children:"Loading..."})}),t("p",{className:"text-[10px] text-slate-400 font-bold uppercase",children:K==="showing_offer"?"Guests scan this code":"Host scans this code"})]}),q==="link"&&t("div",{className:"space-y-6 py-8",children:l("div",{className:"p-6 bg-blue-50 rounded-3xl border border-blue-100",children:[t(h.Share,{className:"w-12 h-12 text-blue-500 mx-auto mb-4"}),t("p",{className:"text-sm font-bold text-slate-600 leading-relaxed mb-6",children:"Send this link to someone on another device (PC, Tablet, Phone). It pre-loads the session."}),t("button",{onClick:()=>re(Le,"Invite Link"),className:"w-full py-4 bg-blue-600 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg shadow-blue-500/20",children:"Copy Invitation Link"})]})}),q==="manual"&&l("div",{className:"space-y-4",children:[l("div",{className:"text-left",children:[t("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-1 block",children:"Your Sync Key (Copy this)"}),l("div",{className:"flex gap-2",children:[t("input",{readOnly:!0,value:Pe,className:"flex-1 bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-[10px] font-mono overflow-ellipsis"}),t("button",{onClick:()=>re(E,"Sync Key"),className:"p-3 bg-slate-900 text-white rounded-xl active:scale-95 transition-transform",children:t(h.Check,{className:"w-4 h-4"})})]})]}),l("div",{className:"text-left",children:[t("label",{className:"text-[9px] font-black text-slate-400 uppercase tracking-widest ml-2 mb-1 block",children:"Paste Counterpart Key"}),t("textarea",{value:V,onChange:n=>se(n.target.value),className:"w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 text-[10px] font-mono h-24 resize-none focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"Paste key from other device..."})]}),t("button",{onClick:Ne,className:"w-full py-4 bg-slate-900 text-white rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg active:translate-y-px",children:"Complete Sync"}),t("p",{className:"text-[8px] text-slate-400 font-bold uppercase",children:"Manual keys bridge devices when cameras aren't available"})]})]}),l("div",{className:"space-y-3 pt-4 border-t border-slate-100",children:[K==="showing_offer"&&t("button",{onClick:()=>{y(!0),N(!1)},className:"w-full py-5 bg-blue-600 text-white rounded-2xl font-black uppercase text-xs shadow-xl shadow-blue-500/20 active:scale-[0.98] transition-all",children:"Next: Scan Guest Response"}),t("button",{onClick:()=>N(!1),className:"w-full py-5 bg-slate-100 text-slate-600 rounded-2xl font-black uppercase text-xs hover:bg-slate-200 transition-colors",children:"Dismiss"})]})]})})]})},be=Qe;import{jsx as ge}from"react/jsx-runtime";var xe=document.getElementById("root");if(!xe)throw new Error("Could not find root element to mount to");var Ve=Ke.createRoot(xe);Ve.render(ge(Je.StrictMode,{children:ge(be,{})}));
